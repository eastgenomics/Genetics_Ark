{% extends 'base.html' %}
{% load render_table from django_tables2 %}
{% load static %}



{% block body_block %}

<body style="padding-top: 80px; padding-left: 80px">
<html>
<link rel="stylesheet" type="text/css" href="{% static 'css/link_button.css' %}">

<!-- success message when primer is deleted from edit_primer and returns to index -->
{% if messages %} 
    {% for message in messages %}
        <div class="alert {{ message.tags }}" role="alert">
            <strong>{{ message }}</strong> 
        </div>
    {% endfor %} 
{% endif %} 



<span style="float:right;">
    <a href="/primer_db/help" target="_blank">
    <img style="width: 50px; height: 100px; padding-top: 10px" alt="Image" src="{% static 'images/gif2.gif' %}"/>
    </a>
</span>
    

<h1>Primer Database</h1></br>

<div class = "alert alert-warning">
    <h3>
        This version is still under development. Please check that the data, coverages are correct.<br>
        If you have any suggestions/improvements/issues, email jethro.rainford@addenbrookes.nhs.uk
    </h3>
</div><br>

<div class="row center-block">

<a href="/primer_db/submit"><button type="button" class = "bt btn-primary">Submit single primer</button></a>

<a href="/primer_db/submit_pair"><button type="button" class = "bt btn-primary">Submit primer pair</button></a></br></br>

<!-- form for primer name filter -->
<div class="well">
    <form method="post" action="" style="padding-top:10px;" name="filter_form">
        {% csrf_token %}
        {{ filter_form.name }}
        {{ filter_form.gene }}
        {{ filter_form.location }}
        {{ filter_form.status }}
        <br>
        {{ filter_form.chrom }}
        {{ filter_form.position }}
        <br><br>
        <button name="filter_button" type="submit">Filter</button>
    </form>

    {% if filter_params %}
        <br>
        <div>
            Filtering parameters:
            <ul>
                {% for field, value in filter_params.items %}
                    {% if value %}
                        <li>{{ field }}: {{ value }}</li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</div>

<form action="" method="post">
    {% csrf_token %}

    Change primer status: 

    <select name="new_status">
        <option value="Archived">Archived</option>
        <option value="On Order">On Order</option>
        <option value="In Bank">In Bank</option>
    </select>
    
    <button type="submit" name="change_status"/>Submit</button></br></br>
    
    Select primer pair to recalculate coverage: 

    <input type="submit" name="recalc" value="Recalculate"></br></br>
    
    {% if recalc %}
        <div class="well">
            <ul>
                {% for ele in recalc %}
                    <li>{{ ele |safe }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    {% if nb_primers %}
        <div class="well">
            <ul>
                <li>Number of primers: {{ nb_primers }}</li>
                <li>Number of primers not snp checked: {{ not_check }}</li>
                <li>Number of primers that passed snp check: {{ passed_check }}</li>
                <li>
                    Number of primers that failed snp check: 
                    <button 
                        class="link" 
                        type="submit" 
                        name="failed_snp_check" 
                        style="color: rgb(243, 8, 8);"
                    >{{ failed_check }}</button>
                </li>
                <li>
                    Number of primers manually snp checked: 
                    <button 
                        class="link" 
                        type="submit" 
                        name="manually_snp_check" 
                        style="color: rgb(8, 110, 243);"
                    >{{ manually_checked }}</button>
                </li>
                <li>
                    Number of primers not able to be snp checked: 
                    <button 
                        class="link" 
                        type="submit" 
                        name="not_recognized_snp_check" 
                        style="color: rgb(118, 8, 243);"
                    >{{ not_in_gnomAD }}</button>
                </li>
            </ul>
        </div>
    {% endif %}

    {% render_table table "django_tables2/bootstrap-responsive.html" %}
</form>

</html>
</body>

<a href="/primer_db/"><button type="button" class = "bt btn-primary">View all</button></a></br></br>

Total primers in bank: {{ total_bank }}</br>
Total primers on order: {{ total_order }}</br>
Total primers in archive: {{ total_archived }}</br></br></br>

{% endblock %}

